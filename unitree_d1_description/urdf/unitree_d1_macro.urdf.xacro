<?xml version="1.0"?>

<robot xmlns:xacro="http://ros.org/wiki/xacro">

    <xacro:include filename="$(find unitree_d1_description)/urdf/macros.urdf.xacro" />

    <!-- Propagate last link name information because it is the gripper's parent link -->
    <xacro:property name="last_arm_link" value="Link6" />

    <xacro:macro name="load_arm" params="*origin parent prefix sim_gazebo gripper use_camera">
        <joint name="${prefix}base_joint" type="fixed">
            <xacro:insert_block name="origin" />
            <parent link="${parent}" />
            <child link="${prefix}base_link" />
        </joint>
        <link name="${prefix}base_link">
            <inertial>
                <origin rpy="0 0 0" xyz="-0.00048697 -2.9605E-12 0.017142" />
                <mass value="0.077233" />
                <inertia
                    ixx="0.00010316" ixy="-1.0285E-14" ixz="2.0449E-07"
                    iyy="0.00011888" iyz="7.3026E-15"
                    izz="0.00018362" />
            </inertial>
            <visual>
                <origin rpy="0 0 0" xyz="0 0 0" />
                <geometry>
                    <mesh filename="package://unitree_d1_description/meshes/base_link.STL" />
                </geometry>
                <material name="d1_dark_grey" />
            </visual>
            <collision>
                <origin rpy="0 0 0" xyz="0 0 0" />
                <geometry>
                    <mesh filename="package://unitree_d1_description/meshes/base_link.STL" />
                </geometry>
            </collision>
        </link>

        <link name="${prefix}Link1">
            <inertial>
                <origin rpy="0 0 0" xyz="0.0024649 0.00010517 0.032696" />
                <mass value="0.13174" />
                <inertia
                    ixx="6.7236E-05" ixy="-5.5664E-08" ixz="7.0454E-08"
                    iyy="5.416E-05" iyz="-3.5709E-07"
                    izz="4.6637E-05" />
            </inertial>
            <visual>
                <origin rpy="0 0 0" xyz="0 0 0" />
                <geometry>
                    <mesh filename="package://unitree_d1_description/meshes/Link1.STL" />
                </geometry>
                <material name="d1_dark_grey" />
            </visual>
            <collision>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://unitree_d1_description/meshes/Link1.STL" />
                </geometry>
            </collision>
        </link>
        <joint name="${prefix}joint_1" type="revolute">
            <origin rpy="0 0 -3.1416" xyz="0 0 0.0533" />
            <parent link="${prefix}base_link" />
            <child link="${prefix}Link1" />
            <axis xyz="0 0 1" />
            <limit lower="${min_joint_1_pos}" upper="${max_joint_1_pos}"
                    effort="${joint_1_effort}" velocity="${joint_1_vel}" />
        </joint>

        <link name="${prefix}Link2">
            <inertial>
                <origin rpy="0 0 0" xyz="0.0002018 0.19201 -0.027007" />
                <mass value="0.20213" />
                <inertia
                    ixx="0.00025682" ixy="-1.139E-07" ixz="5.5667E-08"
                    iyy="6.3307E-05" iyz="-3.5717E-07"
                    izz="0.00022968" />
            </inertial>
            <visual>
                <origin rpy="0 0 0" xyz="0 0 0" />
                <geometry>
                    <mesh filename="package://unitree_d1_description/meshes/Link2.STL" />
                </geometry>
                <material name="d1_dark_grey" />
            </visual>
            <collision>
                <origin rpy="0 0 0" xyz="0 0 0" />
                <geometry>
                    <mesh filename="package://unitree_d1_description/meshes/Link2.STL" />
                </geometry>
            </collision>
        </link>
        <joint name="${prefix}joint_2" type="revolute">
            <origin rpy="1.5708 0 -3.1416" xyz="0 0.028 0.0563" />
            <parent link="${prefix}Link1" />
            <child link="${prefix}Link2" />
            <axis xyz="0 0 -1" />
            <limit lower="${min_joint_2_pos}" upper="${max_joint_2_pos}"
                    effort="${joint_2_effort}" velocity="${joint_2_vel}" />
        </joint>

        <link name="${prefix}Link3">
            <inertial>
                <origin rpy="0 0 0" xyz="0.015164 0.044482 -0.027461" />
                <mass value="0.0629" />
                <inertia
                    ixx="1.7232E-05" ixy="-2.6967E-06" ixz="-9.4911E-11"
                    iyy="1.2606E-05" iyz="-9.9169E-11"
                    izz="1.4964E-05" />
            </inertial>
            <visual>
                <origin rpy="0 0 0" xyz="0 0 0" />
                <geometry>
                    <mesh filename="package://unitree_d1_description/meshes/Link3.STL" />
                </geometry>
                <material name="d1_dark_grey" />
            </visual>
            <collision>
                <origin rpy="0 0 0" xyz="0 0 0" />
                <geometry>
                    <mesh filename="package://unitree_d1_description/meshes/Link3.STL" />
                </geometry>
            </collision>
        </link>
        <joint name="${prefix}joint_3" type="revolute">
            <origin rpy="0 0 0" xyz="0 0.2693 0.0009" />
            <parent link="${prefix}Link2" />
            <child link="${prefix}Link3" />
            <axis xyz="0 0 -1" />
            <limit lower="${min_joint_3_pos}" upper="${max_joint_3_pos}"
                    effort="${joint_3_effort}" velocity="${joint_3_vel}" />
        </joint>

        <link name="${prefix}Link4">
            <inertial>
                <origin rpy="0 0 0" xyz="-0.00029556 -0.00016104 0.091339" />
                <mass value="0.083332" />
                <inertia
                    ixx="3.9308E-05" ixy="1.0126E-08" ixz="-9.4316E-08"
                    iyy="3.4378E-05" iyz="-1.6915E-09"
                    izz="1.1597E-05" />
            </inertial>
            <visual>
                <origin rpy="0 0 0" xyz="0 0 0" />
                <geometry>
                    <mesh filename="package://unitree_d1_description/meshes/Link4.STL" />
                </geometry>
                <material name="d1_dark_grey" />
            </visual>
            <collision>
                <origin rpy="0 0 0" xyz="0 0 0" />
                <geometry>
                    <mesh filename="package://unitree_d1_description/meshes/Link4.STL" />
                </geometry>
            </collision>
        </link>
        <joint name="${prefix}joint_4" type="revolute">
            <origin rpy="-1.5708 0 -1.5708" xyz="0.0577 0.042 -0.0275" />
            <parent link="${prefix}Link3" />
            <child link="${prefix}Link4" />
            <axis xyz="0 0 1" />
            <limit lower="${min_joint_4_pos}" upper="${max_joint_4_pos}"
                    effort="${joint_4_effort}" velocity="${joint_4_vel}" />
        </joint>

        <link name="${prefix}Link5">
            <inertial>
                <origin rpy="0 0 0" xyz="0.040573 0.0062891 -0.023838" />
                <mass value="0.053817" />
                <inertia
                    ixx="1.3072E-05" ixy="-3.9511E-07" ixz="-3.1889E-10"
                    iyy="8.6301E-06" iyz="-1.8416E-09"
                    izz="1.1049E-05" />
            </inertial>
            <visual>
                <origin xyz="0 0 0" rpy="0 0 0" />
                <geometry>
                    <mesh filename="package://unitree_d1_description/meshes/Link5.STL" />
                </geometry>
                <material name="d1_dark_grey" />
            </visual>
            <collision>
                <origin rpy="0 0 0" xyz="0 0 0" />
                <geometry>
                    <mesh filename="package://unitree_d1_description/meshes/Link5.STL" />
                </geometry>
            </collision>
        </link>
        <joint name="${prefix}joint_5" type="revolute">
            <origin rpy="1.5708 -1.5708 0" xyz="-0.0001 -0.0237 0.14018" />
            <parent link="${prefix}Link4" />
            <child link="${prefix}Link5" />
            <axis xyz="0 0 -1" />
            <limit lower="${min_joint_5_pos}" upper="${max_joint_5_pos}"
                    effort="${joint_5_effort}" velocity="${joint_5_vel}" />
        </joint>

        <link name="${prefix}Link6">
            <inertial>
                <origin rpy="0 0 0" xyz="0 0 0" />
                <mass value="0.001" />
                <inertia
                    ixx="1e-6" ixy="0" ixz="0"
                    iyy="1e-6" iyz="0"
                    izz="1e-6" />
            </inertial>
        </link>
        <joint name="${prefix}joint_6" type="revolute">
            <origin rpy="-1.5708 0 -1.5708" xyz="0.0825 -0.0010782 -0.023822" />
            <parent link="${prefix}Link5" />
            <child link="${prefix}Link6" />
            <axis xyz="0 0 -1" />
            <limit lower="${min_joint_6_pos}" upper="${max_joint_6_pos}"
                    effort="${joint_6_effort}" velocity="${joint_6_vel}" />
        </joint>

        <!-- Optional components -->
        <xacro:if value="${use_camera}">
            <xacro:include filename="$(find unitree_d1_description)/urdf/camera/_d435.urdf.xacro" />
            <xacro:sensor_d435 parent="${last_arm_link}" prefix="${prefix}" name="camera_1">
                <origin rpy="0 -${M_PI/2} 0.0" xyz="-0.055 0.0 0.02" />
            </xacro:sensor_d435>
        </xacro:if>

        <xacro:if value="${sim_gazebo}">
            <xacro:include filename="$(find unitree_d1_description)/urdf/gz/unitree_d1.gazebo.xacro" />
            <xacro:unitree_d1_gazebo parent="${parent}" prefix="${prefix}" use_camera="${use_camera}" />
        </xacro:if>

        <xacro:include filename="$(find unitree_d1_description)/urdf/ros2_control/unitree_d1_ros2_control.xacro" />
        <xacro:unitree_d1_ros2_control prefix="${prefix}" sim_gazebo="${sim_gazebo}" />

    </xacro:macro>

</robot>